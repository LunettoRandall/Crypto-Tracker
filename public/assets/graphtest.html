<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <script src="https://code.jquery.com/jquery.js"></script>
    <link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons">
    <!-- <script src="https://d3js.org/d3.v4.min.js"></script> -->
    <script defer src="https://code.getmdl.io/1.3.0/material.min.js"></script>
    <script type="text/javascript" src="https://www.gstatic.com/charts/loader.js"></script>
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.18.1/moment-with-locales.min.js"></script>
    <link rel="stylesheet" href="https://code.getmdl.io/1.3.0/material.red-yellow.min.css" />
    <link href="https://fonts.googleapis.com/css?family=Montserrat" rel="stylesheet">
    <link rel="stylesheet" href="./css/style.css" type="text/css" />
    <title>Title</title>
</head>

<body>
    <div class="mdl-layout mdl-js-layout mdl-layout--drawer mdl-layout--fixed-header">
        <header class="mdl-layout__header">
            <div class="mdl-layout__header-row">
                <!-- Title -->
                <span class="mdl-layout-title">Title</span>
                <!-- Add spacer, to align navigation to the right -->
                <div class="mdl-layout-spacer"></div>
                <!-- Navigation -->
                <nav class="mdl-navigation">
                    <a class="mdl-navigation__link" href="/">Home</a>
                    <a class="mdl-navigation__link" href="/">Link</a>
                </nav>
            </div>
        </header>
        <!---        DRAWER         -->
        <div class="mdl-layout__drawer">
            <span class="mdl-layout-title">Title</span>
            <nav class="mdl-navigation">
                <a class="mdl-navigation__link" href="/">Home</a>
                <a class="mdl-navigation__link" href="/">Link</a>
            </nav>
        </div>
        <main class="mdl-layout__content ">
            <div class="page-content">
                <h1 id="main-headers">Track your Coin</h1>
                <div class="mdl-grid">
                    <div class="mdl-cell mdl-cell--12-col mdl-cell--8-col-tablet mdl-cell--6-phone">
                        <!-- ************************************************************************************** -->
                        <form>
                            <!-- <button id="change">Submit</button> -->
                        </form>
                        <div id="chart_div" style="width: 900px; height: 500px"></div>
                        <!-- ************************************************************************************ -->
                        <h2 id="main-headers">Bitcoin</h2>
                        <div class="wide-card mdl-card mdl-shadow--8dp">
                            <div class="mdl-card__title">
                                <h2 class="mdl-card__title-text"></h2>
                            </div>
                            <div class="mdl-card__supporting-text" id="currency">
                            </div>
                            <div class="mdl-card__actions mdl-card--border">
                                <br>
                            </div>
                        </div>
                        <br>
                    </div>
                </div>
            </div>
    </div>
    </main>
    </div>
    <script type="text/javascript">
    var samplePrices = [{
        "id": 1,
        "BTCprice": 0.0004000,
        "USDprice": 2474.88,
        "time": "2017-05-25 14:02:40"
    }, {
        "id": 2,
        "BTCprice": 0.0004000,
        "USDprice": 2482.53,
        "time": "2017-05-25 14:04:45"
    }, {
        "id": 3,
        "BTCprice": 0.0004000,
        "USDprice": 2482.81,
        "time": "2017-05-25 14:05:06"
    }, {
        "id": 4,
        "BTCprice": 0.0004000,
        "USDprice": 2489.82,
        "time": "2017-05-25 14:07:48"
    }, {
        "id": 5,
        "BTCprice": 0.0004000,
        "USDprice": 2489.82,
        "time": "2017-05-25 14:07:49"
    }, {
        "id": 6,
        "BTCprice": 0.0004000,
        "USDprice": 2489.82,
        "time": "2017-05-25 14:07:50"
    }, {
        "id": 7,
        "BTCprice": 0.0004000,
        "USDprice": 2489.78,
        "time": "2017-05-25 14:07:51"
    }, {
        "id": 8,
        "BTCprice": 0.0004000,
        "USDprice": 2489.78,
        "time": "2017-05-25 14:07:52"
    }, {
        "id": 9,
        "BTCprice": 0.0004000,
        "USDprice": 2489.46,
        "time": "2017-05-25 14:07:55"
    }, {
        "id": 10,
        "BTCprice": 0.0004000,
        "USDprice": 2489.82,
        "time": "2017-05-25 14:07:56"
    }, {
        "id": 11,
        "BTCprice": 0.0004000,
        "USDprice": 2489.78,
        "time": "2017-05-25 14:07:57"
    }, {
        "id": 12,
        "BTCprice": 0.0004000,
        "USDprice": 2489.78,
        "time": "2017-05-25 14:07:58"
    }, {
        "id": 13,
        "BTCprice": 0.0004000,
        "USDprice": 2489.78,
        "time": "2017-05-25 14:07:59"
    }, {
        "id": 14,
        "BTCprice": 0.0004000,
        "USDprice": 2489.46,
        "time": "2017-05-25 14:08:00"
    }, {
        "id": 15,
        "BTCprice": 0.0004000,
        "USDprice": 2486.79,
        "time": "2017-05-25 14:08:03"
    }, {
        "id": 19,
        "BTCprice": 0.0004000,
        "USDprice": 2486.79,
        "time": "2017-05-25 14:08:07"
    }, {
        "id": 20,
        "BTCprice": 0.0004000,
        "USDprice": 2487.08,
        "time": "2017-05-25 14:08:08"
    }, {
        "id": 23,
        "BTCprice": 0.0004000,
        "USDprice": 2486.79,
        "time": "2017-05-25 14:08:11"
    }, {
        "id": 24,
        "BTCprice": 0.0004000,
        "USDprice": 2488.08,
        "time": "2017-05-25 14:08:24"
    }, {
        "id": 25,
        "BTCprice": 0.0004000,
        "USDprice": 2491.17,
        "time": "2017-05-25 14:08:34"
    }, {
        "id": 26,
        "BTCprice": 0.0004000,
        "USDprice": 2488.85,
        "time": "2017-05-25 14:08:44"
    }, {
        "id": 27,
        "BTCprice": 0.0004000,
        "USDprice": 2490.11,
        "time": "2017-05-25 14:08:54"
    }]

    var chartPointArray = []
    var BTCprice = 0;
    var USDprice = 0;

    $(document).ready(function() {

        function get_tblcurrency() {
            $.get("/tblcurrency", function(data) {
                console.log(data);
                createChartPoints(data);
                // setInterval(get_tblcurrency(), 600000)
            });
        }

        get_tblcurrency();

        function createChartPoints(data) {
            console.log(data[0].tstamp)
            for (i = 0; i < data.length; i++) {
                var dbTime = data[i].tstamp.split("T");
                var date = dbTime[0].split("-");
                var time = dbTime[1].split(":").slice(0, -1);
                var timeArray = date.concat(time);
                var chartPoint = {
                    time: timeArray,
                    price: data[i].USDprice
                };
                chartPointArray.push(chartPoint)
            }
            console.log(timeArray)
            console.log(chartPointArray)
        }

        /*
        function priceUSD() {

            $.get("https://min-api.cryptocompare.com/data/price?fsym=USD&tsyms=BTC,ETH,EUR", function(data) {
                USDprice = data.BTC;
                // console.log(USDprice);
                $("#currency").append(`USD/BTC: $${USDprice}<br>`)
            });
        }

        function priceBTC() {
            $.get("https://min-api.cryptocompare.com/data/price?fsym=BTC&tsyms=USD,ETH,EUR", function(data) {
                BTCprice = data.USD;
                console.log(BTCprice)
                $("#currency").append(`BTC/USD: $${BTCprice}`)

            });
        }
        */


        var now = moment().format("X");
        var month = moment(JSON.stringify(now), "MM-YYYY");
        var hour = moment(JSON.stringify(now), "hh");
        var day = moment().format("MM-DD-YY");
        /*
        priceUSD();
        priceBTC();
        */
        // ************************************************************************************


        google.charts.load('current', {
            packages: ['corechart', 'line']
        });
        google.charts.setOnLoadCallback(drawLogScales);

        function drawLogScales() {
            var data = new google.visualization.DataTable();
            data.addColumn('datetime', 'Date');
            data.addColumn('number', 'BTC/USD');
            // data.addColumn('number', 'BTC');

            for (i = 0; i < chartPointArray.length; i++) {
                var newPoint = chartPointArray[i];
                // console.log(newPoint)

                data.addRows([
                    [new Date(newPoint.time[0], newPoint.time[1] - 1, newPoint.time[2], newPoint.time[3] - 7, newPoint.time[4]), newPoint.price]
                ])
            }

            var options = {
                hAxis: {
                    title: 'Time',
                    logScale: false

                },
                vAxis: {
                    title: 'Price (USD)',
                    logScale: true,
                    format: "currency"
                },
                colors: ['#30d138']
            };

            var chart = new google.visualization.LineChart(document.getElementById('chart_div'));
            chart.draw(data, options);
        }

        // $("#change").onclick = function() {
        //     // If the format option matches, change it to the new option,
        //     // if not, reset it to the original format.
        //     options.hAxis.format === 'M/d/yy' ?
        //         options.hAxis.format = 'MMM dd, yyyy' :
        //         options.hAxis.format = 'M/d/yy';

        //     chart.draw(data, options);
        // };
    })


    function createRows() {


    }
    </script>
</body>

</html>
